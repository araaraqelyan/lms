{% extends 'layouts/base-fullscreen.html' %}
{% load i18n static admin_soft %}

{% block content %}

  {% include 'includes/navigation-fullscreen.html' %}

  <main class="main-content  mt-0">
    <section>
      <div class="page-header min-vh-75">
        <div class="container">
          <div class="row">
            <div class="col-xl-4 col-lg-5 col-md-6 d-flex flex-column mx-auto">
              <div class="card card-plain mt-8">
                <div class="card-header pb-0 text-left bg-transparent">
                  <h3 class="font-weight-bolder text-info text-gradient">
                    Create Quiz
                  </h3>
                  <p class="mb-0">
                    {% if msg %}
                      <span class="text-danger">{{ msg | safe }}</span>
                    {% else %}
                      <!-- Add your credentials -->
                    {% endif %}
                  </p>
                </div>
                <div class="card-body">

                  {% if success %}

                      <p class="text-sm mt-3 mb-0 text-center">
                      <div class="text-center">
                          <a href="{% url 'login' %}" class="btn bg-gradient-dark w-100 my-4 mb-2">Submit</a>
                      </div>
                      </p>

                  {% else %}

                      <form role="form" method="post" enctype="multipart/form-data">  <!-- Set enctype to handle file uploads -->

                          {% csrf_token %}

                          <!-- Quiz Title -->
                          <label for="id_title">Quiz Title</label>
                          <input type="text" id="id_title" name="title" class="form-control mb-3">

                          <!-- Quiz Complexity -->
                          <label for="id_complexity">Quiz Complexity</label>
                          <select id="id_complexity" name="complexity" class="form-control mb-3">
                            <option value="easy">Easy</option>
                            <option value="medium">Medium</option>
                            <option value="hard">Hard</option>
                          </select>

                          <!-- Quiz Attempts -->
                          <label for="id_attempts">Quiz Attempts</label>
                          <input type="number" id="id_attempts" name="attempts" class="form-control mb-3">

                          <!-- Quiz Deadline -->
                          <label for="id_deadline">Quiz Deadline</label>
                          <input type="datetime-local" id="id_deadline" name="deadline" class="form-control mb-3">

                          <!-- Quiz Success Criteria -->
                          <label for="id_success_criteria">Quiz Success Criteria</label>
                          <textarea id="id_success_criteria" name="success_criteria" class="form-control mb-3"></textarea>

                          <!-- Add Question Button -->
                          <button type="button" id="add_question" class="btn bg-gradient-info w-100 mt-4 mb-2">Add Question</button>

                          <div id="questions">
                            <!-- Questions will be dynamically added here -->
                          </div>

                          <script>
  let questionCount = 0;
  let answerCount = 0;

  // Function to add a new question
  function addQuestion() {
    const questionDiv = document.createElement('div');
    questionDiv.innerHTML = `
      <label for="question_${questionCount}">Question</label>
      <input type="text" name="question_${questionCount}" required>
      <label for="question_type_${questionCount}">Question Type</label>
      <select name="question_type_${questionCount}" required>
        <option value="radio">Radio</option>
        <option value="checkbox">Checkbox</option>
      </select>
      <div class="answers" id="answers_${questionCount}">
        <!-- Answers will be dynamically added here -->
      </div>
    `;
    document.getElementById('questions').appendChild(questionDiv);

    // Add Answer Button for the current question
    const addAnswerButton = document.createElement('button');
    addAnswerButton.type = 'button';
    addAnswerButton.className = 'btn bg-gradient-success w-100 mt-2 mb-2';
    addAnswerButton.textContent = 'Add Answer';
    addAnswerButton.addEventListener('click', function () {
      addAnswer(questionCount);
    });
    questionDiv.appendChild(addAnswerButton);

    questionCount++;
  }

  // Function to add a new answer for a given question
  function addAnswer(questionIndex) {
    try {
        // Ensure the DOM element exists
        const answersContainer = document.getElementById(`answers_${questionIndex}`);
        if (!answersContainer) {
            throw new Error(`Answers container not found for question ${questionIndex}`);
        }

        // Create a new answer div
        const answerDiv = document.createElement('div');
        answerDiv.innerHTML = `
            <label for="answer_${questionIndex}_${answerCount}">Answer</label>
            <input type="text" name="answer_${questionIndex}_${answerCount}" required>
            <label for="is_correct_${questionIndex}_${answerCount}">Is Correct</label>
            <input type="checkbox" name="is_correct_${questionIndex}_${answerCount}">
        `;

        // Append the new answer div to the answers container
        answersContainer.appendChild(answerDiv);

        // Increment answerCount for the next answer
        answerCount++;
    } catch (error) {
        console.error('Error adding answer:', error.message);
    }
}


  // Add event listener for the "Add Question" button
  document.getElementById('add_question').addEventListener('click', function () {
    addQuestion();
  });
</script>
                          <div class="text-center">
                            <button type="submit" class="btn bg-gradient-info w-100 mt-4 mb-0">Submit</button>
                          </div>

                      </form>

                  {% endif %}

                </div>

                <div class="card-footer text-center pt-0 px-lg-2 px-1">
                  <p class="mb-4 text-sm mx-auto">
                    {% url 'admin_password_reset' as password_reset_url %}
                    {% if password_reset_url %}
                    <a href="{{ password_reset_url }}" class="text-info text-gradient font-weight-bold">
                        Forgotten your password or username?
                    </a>
                    {% endif %}
                  </p>
                </div>
              </div>
            </div>
            <div class="col-md-6">
              <div class="oblique position-absolute top-0 h-100 d-md-block d-none me-n8">
                <div class="oblique-image bg-cover position-absolute fixed-top ms-auto h-100 z-index-0 ms-n6" style="background-image:url('{% static 'img/curved-images/curved6.jpg' %}')"></div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
  </main>

  {% include 'includes/footer-fullscreen.html' %}

{% endblock content %}

